<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Google Analytics y Publicidad con consentimiento -->
    <script src="../js/ads-analytics.js"></script>     
    <!-- End Google Analytics y Publicidad con consentimiento -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <title>Marcador de Fútbol Sala con Cronómetro | Liga Escolar</title>
    <meta name="description" content="Marcador digital para fútbol sala con cronómetro, tiempos, prórroga, tarjetas amarillas/azules y control completo del partido.">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Fútbol Sala">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="/imagenes/apple-touch-icon-180x180.png">
    <link rel="manifest" href="manifest.json">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/themes.css">
    <link rel="stylesheet" href="../css/layout.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/header-with-bg.css">
    <!-- Estilo específico de fútbol sala actualizado -->
    <link rel="stylesheet" href="../css/sport-specific/futbol-sala.css">
    
    <!-- Favicon -->
    <link rel="icon" href="/imagenes/favicon.ico" type="image/x-icon">
    <link rel="icon" type="image/png" sizes="32x32" href="/imagenes/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/imagenes/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/imagenes/apple-touch-icon-180x180.png">

    <style>
        /* Estilos críticos para móvil */
        @media (max-width: 768px) {
            .mobile-optimized { font-size: 14px; }
            .touch-friendly { min-height: 44px; min-width: 44px; }
        }
        
        /* Mejoras para orientación horizontal */
        @media (orientation: landscape) and (max-height: 600px) {
            .landscape-mode { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
            .landscape-compact { padding: 5px; margin: 5px 0; }
            .landscape-hide { display: none; }
        }
        
        /* Estilos adicionales para eventos */
        .events-history {
            background-color: rgba(44, 62, 80, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(5px);
        }
        
        .events-history h2 {
            margin-bottom: 15px;
            color: #ffd700;
        }
        
        .events-list {
            max-height: 200px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .timer-container {
            background: rgba(44, 62, 80, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .main-timer {
            font-size: 4rem;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .period-info {
            font-size: 1.2rem;
            color: #ecf0f1;
            margin-top: 10px;
        }
        
        .control-group {
            margin: 20px 0;
        }
        
        .control-group-label {
            text-align: center;
            margin-bottom: 15px;
            color: #ffd700;
            font-weight: bold;
        }
        
        .time-controls, .match-controls, .export-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .btn-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            padding: 10px 15px;
        }
        
        .vs-separator {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body class="theme-futbol-sala">
    <!-- Botones flotantes -->
    <button class="floating-home-btn" onclick="window.location.href='/';" title="Volver al inicio">
        <i class="fas fa-home"></i>
    </button>
    
    <button class="floating-help-btn" onclick="openHelpModal()" title="Ayuda">
        <i class="fas fa-question"></i>
    </button>
    
    <div class="container">
        <header class="app-header">
            <div class="header-bg">
                <img src="/imagenes/pizarra.png" alt="Fondo pizarra deportiva" class="header-bg-image">
            </div>
            
            <div class="header-content">
                <div class="header-left">
                    <h1><i class="fas fa-futbol"></i> Marcador de Fútbol Sala</h1>
                    <p class="subtitle">Liga Escolar - <span id="current-location">No especificada</span></p>
                    <p class="game-rules-futbol-sala">
                        <i class="fas fa-info-circle"></i> 
                        2 tiempos de 20 min | Prórroga 2x5 min | Timeouts: 1 por tiempo
                    </p>
                    <div class="input-group">
                        <input type="text" id="match-location-input" placeholder="Ingresa la ubicación del partido">
                        <button class="btn btn-small" id="save-location">
                            <i class="fas fa-check"></i> Guardar
                        </button>
                    </div>
                </div>
                <div class="header-right">
                    <div class="clock-container clock-container-futbol-sala">
                        <div id="clock">00:00:00</div>
                        <div id="date">--/--/----</div>
                    </div>
                </div>
            </div>
        </header>

        <!-- INFORMACIÓN DEL PARTIDO (Compacta para móvil) -->
        <div class="match-info-futbol-sala mobile-optimized">
            <div class="match-info-item">
                <span class="info-label">Periodo:</span>
                <span class="info-value" id="current-period">1° Tiempo</span>
            </div>
            <div class="match-info-item">
                <span class="info-label">Tiempo:</span>
                <span class="info-value" id="match-timer">20:00</span>
            </div>
            <div class="match-info-item">
                <span class="info-label">Estado:</span>
                <span class="info-value" id="match-status">No iniciado</span>
            </div>
        </div>

        <!-- CRONOMETRO PRINCIPAL -->
        <div class="timer-container">
            <div class="main-timer" id="main-timer">
                20:00
            </div>
            <div class="period-info" id="period-info">
                1° Tiempo
            </div>
        </div>

        <!-- CONTROLES DE TIEMPO -->
        <div class="control-group">
            <div class="control-group-label">Controles de Tiempo</div>
            <div class="time-controls">
                <button class="btn-icon btn-timer-start touch-friendly" id="start-timer" title="Iniciar Tiempo">
                    <i class="fas fa-play"></i>
                    <span>Iniciar</span>
                </button>
                
                <button class="btn-icon btn-timer-pause touch-friendly" id="pause-timer" title="Pausar Tiempo">
                    <i class="fas fa-pause"></i>
                    <span>Pausar</span>
                </button>
                
                <button class="btn-icon btn-timer-reset touch-friendly" id="reset-timer" title="Reiniciar Tiempo">
                    <i class="fas fa-redo-alt"></i>
                    <span>Reiniciar</span>
                </button>
                
                <button class="btn-icon btn-next-period touch-friendly" id="next-period" title="Siguiente Periodo">
                    <i class="fas fa-forward"></i>
                    <span>Siguiente</span>
                </button>
            </div>
        </div>

        <!-- SCOREBOARD PRINCIPAL -->
        <div class="scoreboard-futbol-sala">
            <div class="team-futbol-sala" id="team1">
                <div class="team-header">
                    <div class="team-name-futbol-sala editable" data-team="1" id="team1-name">Equipo Local</div>
                    <div class="team-summary">
                        <span class="summary-item"><i class="fas fa-exclamation-triangle"></i> <span id="team1-fouls">0</span></span>
                        <span class="summary-item"><i class="fas fa-clock"></i> <span id="team1-timeouts">1</span></span>
                    </div>
                </div>
                <div class="score-futbol-sala" id="team1-score">0</div>
                <div class="score-controls">
                    <button class="btn btn-primary touch-friendly" id="team1-add-goal">
                        <i class="fas fa-plus"></i> Gol
                    </button>
                    <button class="btn btn-secondary touch-friendly" id="team1-remove-goal">
                        <i class="fas fa-minus"></i> Gol
                    </button>
                </div>
                <div class="quick-controls">
                    <button class="btn btn-small btn-foul touch-friendly" id="team1-foul" title="Añadir Falta">
                        <i class="fas fa-exclamation-triangle"></i> Falta
                    </button>
                    <button class="btn btn-small btn-timeout touch-friendly" id="team1-timeout" title="Usar Timeout">
                        <i class="fas fa-clock"></i> Timeout
                    </button>
                </div>
            </div>

            <div class="vs-separator">VS</div>

            <div class="team-futbol-sala" id="team2">
                <div class="team-header">
                    <div class="team-name-futbol-sala editable" data-team="2" id="team2-name">Equipo Visitante</div>
                    <div class="team-summary">
                        <span class="summary-item"><i class="fas fa-exclamation-triangle"></i> <span id="team2-fouls">0</span></span>
                        <span class="summary-item"><i class="fas fa-clock"></i> <span id="team2-timeouts">1</span></span>
                    </div>
                </div>
                <div class="score-futbol-sala" id="team2-score">0</div>
                <div class="score-controls">
                    <button class="btn btn-primary touch-friendly" id="team2-add-goal">
                        <i class="fas fa-plus"></i> Gol
                    </button>
                    <button class="btn btn-secondary touch-friendly" id="team2-remove-goal">
                        <i class="fas fa-minus"></i> Gol
                    </button>
                </div>
                <div class="quick-controls">
                    <button class="btn btn-small btn-foul touch-friendly" id="team2-foul" title="Añadir Falta">
                        <i class="fas fa-exclamation-triangle"></i> Falta
                    </button>
                    <button class="btn btn-small btn-timeout touch-friendly" id="team2-timeout" title="Usar Timeout">
                        <i class="fas fa-clock"></i> Timeout
                    </button>
                </div>
            </div>
        </div>

        <!-- SECCIÓN DE TARJETAS -->
        <div class="cards-section">
            <div class="section-header">
                <h2><i class="fas fa-id-card"></i> Control de Tarjetas</h2>
                <button class="btn btn-small" onclick="resetCards()">
                    <i class="fas fa-redo"></i> Reiniciar Tarjetas
                </button>
            </div>
            
            <div class="cards-container">
                <!-- Equipo Local -->
                <div class="team-cards-section">
                    <h3 class="team-title" id="team1-cards-title">Local</h3>
                    <div class="players-cards-grid" id="team1-players-cards">
                        <!-- Jugadores generados dinámicamente -->
                    </div>
                </div>
                
                <!-- Equipo Visitante -->
                <div class="team-cards-section">
                    <h3 class="team-title" id="team2-cards-title">Visitante</h3>
                    <div class="players-cards-grid" id="team2-players-cards">
                        <!-- Jugadores generados dinámicamente -->
                    </div>
                </div>
            </div>
        </div>

        <!-- RESUMEN DE TARJETAS -->
        <div class="cards-summary">
            <div class="summary-team">
                <h4><i class="fas fa-users"></i> Local</h4>
                <div class="summary-cards">
                    <span class="summary-card yellow"><i class="fas fa-square"></i> <span id="team1-yellow-total">0</span></span>
                    <span class="summary-card blue"><i class="fas fa-square"></i> <span id="team1-blue-total">0</span></span>
                </div>
            </div>
            <div class="summary-team">
                <h4><i class="fas fa-users"></i> Visitante</h4>
                <div class="summary-cards">
                    <span class="summary-card yellow"><i class="fas fa-square"></i> <span id="team2-yellow-total">0</span></span>
                    <span class="summary-card blue"><i class="fas fa-square"></i> <span id="team2-blue-total">0</span></span>
                </div>
            </div>
        </div>

        <!-- CONTROLES DEL PARTIDO -->
        <div class="control-group">
            <div class="control-group-label">Controles del Partido</div>
            <div class="match-controls">
                <button class="btn-icon btn-overtime" id="activate-overtime" title="Activar Prórroga">
                    <i class="fas fa-plus-circle"></i>
                    <span>Prórroga</span>
                </button>
                
                <button class="btn-icon btn-reset" id="reset-match" title="Reiniciar Partido">
                    <i class="fas fa-redo-alt"></i>
                    <span>Reiniciar</span>
                </button>
                
                <button class="btn-icon btn-save" id="save-match" title="Guardar Partido">
                    <i class="fas fa-save"></i>
                    <span>Guardar</span>
                </button>
            </div>
        </div>

        <!-- COMPARTIR -->
        <div class="control-group">
            <div class="control-group-label">Compartir Resultados</div>
            <div class="export-controls">
                <button class="btn-icon btn-whatsapp" id="share-whatsapp" title="Compartir por WhatsApp">
                    <i class="fab fa-whatsapp"></i>
                    <span>WhatsApp</span>
                </button>
                
                <button class="btn-icon btn-share-current" id="share-results" title="Compartir Partido Actual">
                    <i class="fas fa-share-square"></i>
                    <span>Partido</span>
                </button>
                
                <button class="btn-icon btn-share-history" id="share-history" title="Compartir Historial">
                    <i class="fas fa-history"></i>
                    <span>Historial</span>
                </button>
            </div>
        </div>

        <!-- EVENTOS RECIENTES -->
        <div class="events-history">
            <h2><i class="fas fa-list-alt"></i> Historial de Eventos</h2>
            <div class="events-list" id="events-list">
                <!-- Eventos generados dinámicamente -->
            </div>
        </div>

        <!-- HISTORIAL DE PARTIDOS -->
        <div class="history">
            <h2><i class="fas fa-history"></i> Historial de Partidos</h2>
            <div class="history-list" id="history-list">
                <!-- Partidos guardados -->
            </div>
        </div>

        <!-- FOOTER -->
        <footer>
            <p>© 2025 Liga Escolar - Marcador de Fútbol Sala</p>
            <p class="footer-links">
                <a href="https://www.ligaescolar.es/privacidad.html">Privacidad</a> |
                <a href="#" onclick="openRulesModal()">Reglas</a> |
                <a href="#" onclick="openHelpModal()">Ayuda</a>
            </p>
        </footer>
    </div>

    <!-- Modal de Ayuda -->
    <div class="modal" id="help-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-question-circle"></i> Ayuda - Fútbol Sala</h2>
                <button class="close-modal" onclick="closeHelpModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="help-section">
                    <h3><i class="fas fa-mobile-alt"></i> Instalar como App</h3>
                    <div class="install-instructions">
                        <div class="os-install">
                            <h4><i class="fab fa-android"></i> Android (Chrome)</h4>
                            <ol>
                                <li>Abre el menú (tres puntos)</li>
                                <li>Selecciona "Añadir a la pantalla de inicio"</li>
                                <li>Confirma el nombre y añade</li>
                            </ol>
                        </div>
                        <div class="os-install">
                            <h4><i class="fab fa-apple"></i> iPhone (Safari)</h4>
                            <ol>
                                <li>Toca el botón compartir (cuadrado con flecha)</li>
                                <li>Desplázate y selecciona "Añadir a pantalla de inicio"</li>
                                <li>Confirma el nombre y añade</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <div class="help-links">
                    <a href="#" class="help-link" onclick="openRulesModal()">
                        <div class="link-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="link-content">
                            <strong>Reglas de Fútbol Sala</strong>
                            <p>Consulta las reglas oficiales del juego</p>
                        </div>
                    </a>
                    
                    <a href="#" class="help-link" onclick="showUsageInstructions()">
                        <div class="link-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="link-content">
                            <strong>Instrucciones de Uso</strong>
                            <p>Aprende a usar todas las funciones del marcador</p>
                        </div>
                    </a>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeHelpModal()">
                    <i class="fas fa-check"></i> Entendido
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Reglas -->
    <div class="modal" id="rules-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-book"></i> Reglas de Fútbol Sala</h2>
                <button class="close-modal" onclick="closeRulesModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="rules-content">
                    <h3>Reglas Básicas</h3>
                    <ul>
                        <li><strong>Duración:</strong> 2 tiempos de 20 minutos cronometrados</li>
                        <li><strong>Jugadores:</strong> 5 por equipo (1 portero + 4 jugadores)</li>
                        <li><strong>Timeouts:</strong> 1 por equipo por tiempo (1 minuto)</li>
                        <li><strong>Faltas:</strong> Acumulativas por equipo</li>
                        <li><strong>Tarjetas:</strong> 
                            <span style="color: #FFD700;">2 amarillas = 1 azul (expulsión)</span>
                        </li>
                        <li><strong>Prórroga:</strong> 2 tiempos de 5 minutos en caso de empate</li>
                    </ul>
                    
                    <h3>Sistema de Tarjetas</h3>
                    <div class="cards-explanation">
                        <div class="card-example yellow">
                            <i class="fas fa-square"></i>
                            <div>
                                <strong>Tarjeta Amarilla:</strong> Amonestación
                            </div>
                        </div>
                        <div class="card-example blue">
                            <i class="fas fa-square"></i>
                            <div>
                                <strong>Tarjeta Azul:</strong> Expulsión (2 amarillas o falta grave)
                            </div>
                        </div>
                    </div>
                    
                    <h3>Control en esta App</h3>
                    <ul>
                        <li>Gol: +1 punto al equipo correspondiente</li>
                        <li>Falta: Se acumulan por equipo</li>
                        <li>Timeout: 1 por equipo por tiempo (se desactiva al usar)</li>
                        <li>Tarjetas: Control individual por jugador</li>
                        <li>Corrección: Botón "Deshacer" en cada jugador</li>
                    </ul>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeRulesModal()">
                    <i class="fas fa-times"></i> Cerrar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de instrucciones de uso -->
    <div class="modal" id="usage-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-info-circle"></i> Instrucciones de Uso</h2>
                <button class="close-modal" onclick="closeUsageModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="instructions-content">
                    <h3>Cómo usar el marcador</h3>
                    
                    <div class="instruction-step">
                        <h4><i class="fas fa-futbol"></i> Goles</h4>
                        <p>Usa los botones <strong>+ Gol</strong> y <strong>- Gol</strong> para añadir o quitar goles a cada equipo.</p>
                    </div>
                    
                    <div class="instruction-step">
                        <h4><i class="fas fa-id-card"></i> Tarjetas</h4>
                        <p>Cada jugador tiene controles para:
                            <br><i class="fas fa-square" style="color: #FFD700;"></i> <strong>Amarilla:</strong> +A para añadir
                            <br><i class="fas fa-square" style="color: #2196F3;"></i> <strong>Azul:</strong> +Z para añadir directamente
                            <br><i class="fas fa-undo"></i> <strong>Deshacer:</strong> Quita la última tarjada
                        </p>
                        <p><strong>Regla:</strong> 2 tarjetas amarillas = 1 azul (expulsión automática)</p>
                    </div>
                    
                    <div class="instruction-step">
                        <h4><i class="fas fa-exclamation-triangle"></i> Faltas y Timeouts</h4>
                        <p><strong>Faltas:</strong> Se acumulan por equipo (botón Falta)</p>
                        <p><strong>Timeouts:</strong> 1 por equipo por tiempo (botón Timeout)</p>
                    </div>
                    
                    <div class="instruction-step">
                        <h4><i class="fas fa-clock"></i> Cronómetro</h4>
                        <p>Controla el tiempo del partido con:
                            <br><i class="fas fa-play"></i> <strong>Iniciar/Pausar:</strong> Control del tiempo
                            <br><i class="fas fa-forward"></i> <strong>Siguiente tiempo:</strong> Avanza al siguiente periodo
                        </p>
                    </div>
                    
                    <div class="instruction-step">
                        <h4><i class="fas fa-mobile-alt"></i> Modo Horizontal</h4>
                        <p>Para mejor visualización, gira tu móvil a horizontal. La interfaz se adaptará automáticamente.</p>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeUsageModal()">
                    <i class="fas fa-check"></i> Entendido
                </button>
            </div>
        </div>
    </div>

    <!-- Modales existentes (se mantienen) -->
    <div class="modal" id="team-name-modal">
        <div class="modal-content">
            <h2>Editar Nombre del Equipo</h2>
            <div class="form-group">
                <label for="team-name-input">Nombre del equipo:</label>
                <input type="text" id="team-name-input" placeholder="Ingresa el nombre del equipo">
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" id="cancel-edit">Cancelar</button>
                <button class="btn btn-primary" id="save-name">Guardar</button>
            </div>
        </div>
    </div>

    <div class="modal" id="save-match-modal">
        <div class="modal-content">
            <h2>Guardar Partido (Fútbol Sala)</h2>
            <div class="form-group">
                <label>Resultado:</label>
                <div class="card">
                    <p id="save-match-result"></p>
                </div>
            </div>
            <div class="form-group">
                <label>Ubicación:</label>
                <div class="card">
                    <p id="save-match-location"></p>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" id="cancel-save">Cancelar</button>
                <button class="btn btn-primary" id="confirm-save">Guardar Partido</button>
            </div>
        </div>
    </div>

    <div class="modal" id="share-modal">
        <div class="modal-content">
            <h2 id="share-modal-title">Compartir Resultados</h2>
            <div class="share-preview">
                <h3 id="share-preview-title">Vista previa:</h3>
                <div id="share-text">
                    <!-- Texto generado dinámicamente -->
                </div>
                <div class="modal-buttons">
                    <button class="btn btn-secondary" id="copy-text">
                        <i class="fas fa-copy"></i> Copiar
                    </button>
                    <button class="btn btn-success" id="share-native">
                        <i class="fas fa-share"></i> Compartir
                    </button>
                    <button class="btn btn-secondary" id="close-share">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notificación -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notification-text">Operación realizada</span>
    </div>

    <!-- Scripts -->
    <script src="../js/clock.js"></script>
    <script src="../js/celebrate.js"></script>
    <script src="../js/common.js"></script>
    <script src="../js/storage.js"></script>
    <script src="../js/match-core.js"></script>
    <script src="../js/modal-manager.js"></script>
    <!-- Nuevo archivo de fútbol sala con tarjetas -->
    <script src="../js/futbol-sala.js"></script>
    
    <!-- Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
          window.addEventListener('load', () => {
            // Registramos el SW específico de esta carpeta
            navigator.serviceWorker.register('sw.js', { scope: '/futbol-sala/' })
              .then(reg => console.log('PWA de Fútbol Sala lista:', reg.scope))
              .catch(err => console.error('Error PWA:', err));
          });
        }
    </script>
</body>
</html>
